<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Stats - Lowkeycraft</title>
    <link rel="icon" href="logo.png" type="image/x-icon">
    <link rel="stylesheet" href="style.css">

    <meta name="og:card" content="summary_large_image">
    <meta name="og:title" content="Player Stats - Lowkeycraft">
    <meta name="og:description" content="Check your Minecraft player statistics and profile information on Lowkeycraft server.">
    <meta name="og:url" content="https://lowkeycraft.net/logo.png">
    <meta content="#2ae88a" data-react-helmet="true" name="theme-color">
    <meta name="google-site-verification" content="16MaYtHjuvQX2w8Hocvgembth-ta3El1KVCbawKO13E" />
    <meta name="google-adsense-account" content="ca-pub-6389097554596560">

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6389097554596560"
     crossorigin="anonymous"></script>

</head>

<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <img src="./logo.png" alt="Lowkeycraft Logo">
                    <h1 class="site-title">LOWKEYCRAFT</h1>
                </div>
                <nav>
                    <a href="index.html">Home</a>
                    <a href="discord.html">Discord</a>
                    <a href="staff.html">Staff</a>
                    <a href="stats.html" class="active">Stats</a>
                    <a href="tos.html">Terms</a>
                    <a href="policy.html">Privacy</a>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <section class="hero-section">
            <div class="container">
                <h1 class="hero-title">Player Statistics</h1>
                <p class="hero-subtitle">Check Your Minecraft Profile & Stats</p>
                <p class="hero-description">Enter your Minecraft username to view your player profile, skin, and statistics. Get detailed information about your Minecraft account including UUID, skin history, and more.</p>
            </div>
        </section>

        <section class="section">
            <div class="container">
                <div class="feature-card" style="max-width: 600px; margin: 0 auto 2rem;">
                    <h2 style="color: var(--green-400); margin-bottom: 1.5rem; text-align: center;">Player Statistics</h2>

                    <div style="margin-bottom: 1.5rem;">
                        <label for="username" style="display: block; color: var(--text-primary); margin-bottom: 0.5rem; font-weight: 500; font-size: 0.875rem;">Minecraft Username</label>
                        <input type="text" id="username" name="username" placeholder="Enter Minecraft username..." maxlength="16" required style="width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--border); border-radius: 0.5rem; background: rgba(15, 23, 42, 0.8); color: var(--text-primary); font-size: 0.875rem; transition: all 0.2s ease; box-sizing: border-box;">
                    </div>
                    <div style="text-align: center;">
                        <button type="button" id="searchBtn" class="btn btn-primary" style="width: 200px;">Search Player</button>
                    </div>
                </div>

                <div id="loadingIndicator" class="feature-card" style="display: none; max-width: 600px; margin: 0 auto; text-align: center;">
                    <div class="loading" style="position: relative; display: inline-block; width: 2rem; height: 2rem; margin-bottom: 1rem;"></div>
                    <p style="color: var(--text-secondary);">Loading player data...</p>
                </div>

                <div id="errorMessage" style="display: none;"></div>
                <div id="playerResults" style="display: none;"></div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-links">
                    <a href="discord.html">Discord</a>
                    <a href="tos.html">Terms of Service</a>
                    <a href="policy.html">Privacy Policy</a>
                </div>
                <p>© 2025 Fozmu Studios • All Rights Reserved • Lowkeycraft Minecraft Server</p>
                <p>Est. 2024 • Family-friendly server • Global community</p>
                <p>Join our community and start building your legacy today!</p>
            </div>
        </div>
    </footer>

    <script>
        const searchBtn = document.getElementById('searchBtn');
        const usernameInput = document.getElementById('username');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');
        const playerResults = document.getElementById('playerResults');


        searchBtn.addEventListener('click', async () => {
            const username = usernameInput.value.trim();

            if (!username) {
                showError('Please enter a username.');
                return;
            }

            if (username.length < 3 || username.length > 16) {
                showError('Username must be between 3 and 16 characters.');
                return;
            }

            if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                showError('Username can only contain letters, numbers, and underscores.');
                return;
            }

            await searchPlayer(username);
        });


        usernameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchBtn.click();
            }
        });

        usernameInput.addEventListener('focus', function() {
            this.style.borderColor = 'var(--green-500)';
            this.style.boxShadow = '0 0 0 3px rgba(34, 197, 94, 0.1)';
        });

        usernameInput.addEventListener('blur', function() {
            this.style.borderColor = 'var(--border)';
            this.style.boxShadow = 'none';
        });

        async function searchPlayer(username) {
            hideAllResults();
            loadingIndicator.style.display = 'block';

            try {
                const uuid = await getPlayerUUID(username);
                const profile = await getPlayerProfile(uuid, username);

                // Try to get server stats from your plugin
                const serverStats = await getServerPlayerStats(username);

                displayPlayerProfile(profile, serverStats);
            } catch (error) {
                console.error('Error fetching player data:', error);
                showError(error.message || 'Failed to fetch player data. Please try again.');
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }

        async function getPlayerUUID(username) {
            try {
                const response = await fetch(`https://api.minetools.eu/uuid/${username}`);

                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error(`Player "${username}" not found. Please check the username and try again.`);
                    }
                    throw new Error('Failed to fetch player data. Please try again later.');
                }

                const data = await response.json();

                if (data.status === 'ERR') {
                    throw new Error(`Player "${username}" not found. Please check the username and try again.`);
                }

                return data.id.replace(/-/g, '');
            } catch (error) {
                if (error.message.includes('not found')) {
                    throw error;
                }

                console.error('API Error:', error);

                try {
                    const fallbackResponse = await fetch(`https://playerdb.co/api/player/minecraft/${username}`);

                    if (fallbackResponse.ok) {
                        const fallbackData = await fallbackResponse.json();
                        if (fallbackData.success && fallbackData.data.player) {
                            return fallbackData.data.player.id.replace(/-/g, '');
                        }
                    }
                } catch (fallbackError) {
                    console.error('Fallback API Error:', fallbackError);
                }

                throw new Error('Unable to connect to Minecraft services. Please try again later.');
            }
        }

        async function getPlayerProfile(uuid, username) {
            return {
                uuid: uuid,
                username: username,
                originalUsername: username,
                properties: []
            };
        }

        async function getServerPlayerStats(username) {
            try {
                console.log('Attempting to fetch server stats for:', username);

                // Try direct connection first (for local testing)
                try {
                    const directResponse = await fetch(`http://mc.lowkeycraft.net:8080/player/${username}`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    });

                    if (directResponse.ok) {
                        const data = await directResponse.json();
                        console.log('Server stats received:', data);
                        return data;
                    }
                } catch (directError) {
                    console.log('Direct connection failed, trying proxy...', directError.message);
                }

                // Fallback to proxy endpoint
                const response = await fetch('/.netlify/functions/axon-proxy', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: username,
                        endpoint: `http://mc.lowkeycraft.net:8080/player/${username}`
                    })
                });

                if (!response.ok) {
                    console.warn('Proxy response not OK:', response.status, response.statusText);
                    return null;
                }

                const data = await response.json();
                console.log('Proxy response:', data);

                if (data.success && data.data) {
                    return data.data;
                }
                return null;
            } catch (error) {
                console.warn('Failed to fetch server stats:', error);
                return null;
            }
        }

        function displayPlayerProfile(profile, serverStats = null) {
            const formattedUUID = formatUUID(profile.uuid);
            const avatarUrl = `https://crafatar.com/avatars/${profile.uuid}?size=128&overlay`;
            const skinUrl = `https://crafatar.com/renders/body/${profile.uuid}?size=200&overlay`;
            const nameHistoryUrl = `https://namemc.com/profile/${profile.uuid}`;

            // Build server stats section if available
            let serverStatsSection = '';
            if (serverStats) {
                serverStatsSection = `
                    <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border);">
                        <h3 style="color: var(--green-400); margin-bottom: 1.5rem; text-align: center;">Lowkeycraft Server Stats</h3>
                        <div class="player-stats-grid">
                            ${serverStats.playtime ? `
                            <div class="stat-card">
                                <div class="stat-value">${serverStats.playtime}</div>
                                <div class="stat-label">Playtime</div>
                            </div>
                            ` : ''}
                            ${serverStats.firstJoin ? `
                            <div class="stat-card">
                                <div class="stat-value">${serverStats.firstJoin}</div>
                                <div class="stat-label">First Join</div>
                            </div>
                            ` : ''}
                            ${serverStats.lastSeen ? `
                            <div class="stat-card">
                                <div class="stat-value">${serverStats.lastSeen}</div>
                                <div class="stat-label">Last Seen</div>
                            </div>
                            ` : ''}
                            ${serverStats.isOnline !== undefined ? `
                            <div class="stat-card">
                                <div class="stat-value">${serverStats.isOnline ? '🟢 Online' : '🔴 Offline'}</div>
                                <div class="stat-label">Status</div>
                            </div>
                            ` : ''}
                            ${serverStats.blocksPlaced ? `
                            <div class="stat-card">
                                <div class="stat-value">${serverStats.blocksPlaced.toLocaleString()}</div>
                                <div class="stat-label">Blocks Placed</div>
                            </div>
                            ` : ''}
                            ${serverStats.blocksBreaken ? `
                            <div class="stat-card">
                                <div class="stat-value">${serverStats.blocksBreaken.toLocaleString()}</div>
                                <div class="stat-label">Blocks Broken</div>
                            </div>
                            ` : ''}
                            ${serverStats.deaths !== undefined ? `
                            <div class="stat-card">
                                <div class="stat-value">${serverStats.deaths}</div>
                                <div class="stat-label">Deaths</div>
                            </div>
                            ` : ''}
                            ${serverStats.level !== undefined ? `
                            <div class="stat-card">
                                <div class="stat-value">${serverStats.level}</div>
                                <div class="stat-label">Level</div>
                            </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }

            playerResults.innerHTML = `
                <div class="player-profile animate-fade-in">
                    <div class="player-header">
                        <div class="player-skin-display">
                            <div class="skin-avatar">
                                <img src="${avatarUrl}"
                                     alt="${profile.username} Avatar"
                                     class="player-avatar"
                                     width="128"
                                     height="128"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div style="display: none; width: 128px; height: 128px; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; align-items: center; justify-content: center; color: var(--text-muted); font-size: 0.75rem;">
                                    No Avatar
                                </div>
                                <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.5rem;">Avatar</p>
                            </div>
                            <div class="skin-full-body">
                                <img src="${skinUrl}"
                                     alt="${profile.username} Skin"
                                     class="player-skin"
                                     width="100"
                                     height="200"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                <div style="display: none; width: 100px; height: 200px; background: var(--surface); border: 1px solid var(--border); border-radius: 8px; align-items: center; justify-content: center; color: var(--text-muted); font-size: 0.75rem;">
                                    No Skin
                                </div>
                                <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.5rem;">Full Body</p>
                            </div>
                        </div>
                        <div class="player-info">
                            <h2 class="player-name">${profile.username}</h2>
                            <div class="uuid-info">
                                UUID: ${formattedUUID}
                            </div>
                            <p style="color: var(--text-secondary); margin-top: 1rem;">
                                Account Type: <strong style="color: var(--green-400);">Java Edition</strong>
                            </p>
                            <p style="color: var(--text-secondary);">
                                Profile Status: <strong style="color: var(--green-400);">Valid</strong>
                            </p>
                            ${serverStats ? `
                            <p style="color: var(--text-secondary);">
                                Server Data: <strong style="color: var(--green-400);">Available</strong>
                            </p>
                            ` : ''}
                        </div>
                    </div>

                    <div class="player-stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">Java</div>
                            <div class="stat-label">Account Type</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${profile.username.length}</div>
                            <div class="stat-label">Username Length</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">✓</div>
                            <div class="stat-label">Valid Account</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">Active</div>
                            <div class="stat-label">Profile Status</div>
                        </div>
                    </div>

                    ${serverStatsSection}

                </div>
            `;

            playerResults.style.display = 'block';
        }


        function formatUUID(uuid) {
            return uuid.replace(/(.{8})(.{4})(.{4})(.{4})(.{12})/, '$1-$2-$3-$4-$5');
        }

        function showError(message) {
            hideAllResults();
            errorMessage.innerHTML = `
                <div class="error-message animate-fade-in">
                    ${message}
                </div>
            `;
            errorMessage.style.display = 'block';
        }

        function hideAllResults() {
            loadingIndicator.style.display = 'none';
            errorMessage.style.display = 'none';
            playerResults.style.display = 'none';
        }

        usernameInput.addEventListener('input', function(e) {
            hideAllResults();
        });
    </script>
</body>
</html>